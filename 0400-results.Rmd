

# Results and Discussion {-}

## Engage Partners {-}

### Partnership Funding {-}

Through partnership engagement SERN was able to aquire \$105,000 of partnership funding from FLNR (\$80,000) and the Provincial Fish Passage Technical Working Group (\$25,000) towards the 2021/2022 program. Additionally, we have obtained a commitment for \$25,000 of funding from the the Provincial Fish Passage Technical Working Group towards the 2022/2023 program.

```{r}
# define scroll box height for sites
scroll_box_height <- '400px'
```


### Planned Remediations {-}

#### PSCIS Crossing 125179 - Tributary to Missinka River {-}

We are working together with McLeod Lake and Sinclar to advance crossing [125179 (Tributary to Missinka River)](https://newgraphenvironment.github.io/Parsnip_Fish_Passage/03_Parsnip_report_125179.html) on the Chuchinka-Missinka FSR. Works to replace the crossing are planned for summer of 2022. A map of the watershed is provided in map attachment [093I.116](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27//FishPassage_093I.116.pdf). Outputs of `bcfihspass` modelling are presented in (Table \@ref(tab:bcfp-125179))

<br>

Although this crossing is used to access an area of significant cultural value to McLeod Lake due to high recreational values [(unmotorized primitive)](https://catalogue.data.gov.bc.ca/dataset/recreational-opportunity-spectrum-inventory), and is located within a watershed where expansion of "unmotorized primitive" values will occur in the future through deactivation of roads and reforestation, this site was selected as appropriate for restoration for the following reasons:
   
  * At the time of reporting there was significant harvesting and silviculture obligations in areas accessed by the FSR.
  * The Missinka River watershed is designated as a fisheries sensitive watershed under the *Forest and Range Practices Act* [@beaudry2013Assessmentassignmenta] 
  * @hagen_etal2015Criticalhabitats have identified the Missinka River watershed as containing critical spawning and juvenile rearing habitat for large body adult sa'ba (bull trout) with potentially less than 50 spawners utilizing the watershed.
  * The Missinka River watershed is utilized by a possibly genetically distinct, self-sustaining dusk'ihje (Arctic grayling) population with the mainstem of the river providing critical habitat for fry and adult fish  
  * The subject tributary is documented as containing sa'ba.  
  * A bridge design was commissioned for the site in 2020 through funding from FWCP (project PEA-F20-F-2967) so preparations for replacement could be made in a timely fashion.  
  * Portions of artnership funding acquired by SERNbc was used to implement key steps towards fish passage restoration at the site in 2022.  Following the design acquired for the site in 2019/2020 [@irvine2020ParsnipRiver], Sinclar Forest Projects Ltd. has begun delivery of the bridge installation with the following measures completed at the time of reporting:
    + Submission of a Water Sustainability Act Permit Application
    + Development of an Environmental Management Plan 
    + Source, purchase and mobilization of steel girders, modular timber deck and lock block abutment as per site design
          
<br>

Sinclar has sent out a request for proposals for the structure replacement to three qualified contractors.  Project coordination expertise by Sinclar are being provided in-kind. Leveraging support from SERNbc and FWCP, Sinclar will obtain portions of funding for this work through the forestry appraisal system. Bridge installation has been scheduled for the summer of 2022. 

<br>

```{r bcfp-125179}
fpr::fpr_table_bcfp(site = 125179,
                    scroll_box_height = scroll_box_height,
                    scroll = gitbook_on)
```



#### PSCIS 125000 - Tributary to Parsnip River {-}

Working together with McLeod Lake and Sinclar, we are advanceing the replacement of crossing [125000 (Tributary to Parsnip River)](https://newgraphenvironment.github.io/Parsnip_Fish_Passage/03_Parsnip_report_125000.html) on the Chuchinka-Arctic FSR.  A map of the watershed is provided in map attachment  [093I.111](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27//FishPassage_093I.111.pdf) and video from an unmanned aerial vehicle taken in 2019 is available [here](https://www.youtube.com/watch?v=-foWvX1MSkg).  The crossing was prioritized for restoration for the following reasons:
  
  * At the time of reporting there was significant harvesting and silviculture obligations in areas accessed by the FSR.
  * With an outlet drop of 40cm the culvert in place is a complete barrier to upstream fish passage with very low likelihood of any fish movement upstream.
  * The culvert is likely over 30 years old, is undersized and is at risk of washout.  A washout event would result in significant deposition of material downstream of the road (including the mainstem of the Parnip River) and negative impacts on local fisheries values.  
  * The FSR accesses McLeod Lake reservation lands  (ID: Arctic Lake 10) located near the outlet of Arctic Lake.
  * This site is in the general vicinity of the outlet of Arctic Lake which has been identified as a high priority area for taloo'azi (kokanee) and sa'ba (bull trout) by participants in FWCP supported information gathering work [@pearce2019FirstNations].
  * The Chuchinka-Arctic FSR accesses the Arctic Lake Provincial Park which has significant historic and recreational values.  A canoe launch area for the Parsnip River is also located at the upper Parsnip River Bridge.
  * There are no other stream crossing structures on the mainstem of this tributary that impede fish passage.
  * The stream has a large channel width at the crossing location (4.4m) and has an estimated 3.5km of mainstem habitat less than 5% gradient available upstream of the crossing with rainbow Trout and sculpin confirmed as present immediately below the crossing (Table \@ref(tab:bcfp-125000)). Habitat was rated as high value for salmonid rearing and spawning in surveys conducted in 2019.

<br>

```{r bcfp-125000}
fpr::fpr_table_bcfp(site = 125000,
                    scroll_box_height = scroll_box_height,
                    scroll = gitbook_on)
```



#### PSCIS 125345 - Tributary to Parsnip River {-}

British Columbia Timber Sales is planning to deactivate the Chuchinka-Colbourne FSR between the location of [125345 (Tributary to Parsnip River)](https://newgraphenvironment.github.io/Parsnip_Fish_Passage/03_Parsnip_report_125345.html) and the Chuckhinka-Anzac FSR (Table \@ref(tab:bcfp-125345)) (pers comm. Stephanie Sundquist, BCTS Planning Forester). The work is schedule for July and August of 2022.  BCTS was able to obtain funding for the work through the Forest Carbon Initiative and the work will include a full road rehabilitation as well as decompaction and replanting. This full scale rehabilitation approach provides more intensity towards re-vegetation and access management than traditional deactivation practices. Working with BCTS and McLeod Lake we have been in contact with CN Rail to advocate for the removal of crossing 57687 under the railway immediately upstream of the PSCIS crossing 125345 and the Chuchinka-Colbourne FSR. Discussions are ongoing to advocate that action will be taken by CN this summer to remediate crossing 57687 before the access road from the south is deactivated. 

<br>

```{r bcfp-125345}
fpr::fpr_table_bcfp(site = 125345,
                    scroll_box_height = scroll_box_height,
                    scroll = gitbook_on)
```



#### PSCIS 125231 - Tributary to Table River {-}

We are working together with McLeod Lake and Canfor to explore opportunities to advance crossing [125231 (Tributary to Table River)](https://newgraphenvironment.github.io/Parsnip_Fish_Passage/03_Parsnip_report_125231.html) on the Chuchinka-Table FSR for the following reasons:

  * Table River watershed is designated as a fisheries sensitive watershed under the authority of the *Forest and Range Practices Act* due to significant downstream fisheries values and watershed sensitivity [@beaudry2014Assessmentassignmenta]. Special management is required in the crossingâ€™s watershed to protect habitat for sa'ba (bull trout) and dusk'ihje (Arctic grayling) and includes measures (among others) to limit equivalent clearcut area, reduce impacts to natural stream channel morphology, retain old growth attributes and maintain fish habitat/movement.
  * @hagen_etal2015Criticalhabitats have identified the Table River watershed and several tributaries as containing critical spawning and juvenile rearing habitat for large body sa'ba with an estimated minimum spawner abundance of 100 fish.
  * The Table River (along with the Anzac River) is identified as the primary core of post-Williston dusk'ihje distribution in the Parsnip River watershed with life history, migration behaviours and critical habitats summarized in @hagen_etal2015Criticalhabitats. The mainstem of the Table River contains critical habitats for all life stages of dusk'ihje with adults observed moving among mainstem locations and tributaries during summer. 
  * The culvert in place is likely over 30 years old, is undersized and is at risk of washout.  A washout event would result in significant deposition of material downstream of the road and negative impacts on local fisheries values. 
  * The subject tributary is documented as containing rainbow trout with habitat present also suitable for sa'ba rearing and spawning.
  * At the time of reporting there was significant harvesting planned and silviculture obligations outstanding in areas accessed by the FSR.
  * With an outlet drop of 60cm, the culvert in place is a complete barrier to upstream fish passage with very low likelihood of any upstream fish migration.
  * There are no other stream crossing structures on the mainstem of this tributary that impede fish passage. There is a newly installed bridge upstream and the culvert under the CN railway downstream was considered passable according to the provincial protocol [@moe2011Fieldassessment].
  * Although, relatively steep, with gradients falling just outside the currently specified thresholds for highest value bull trout rearing, the stream is capable of supporting bull trout, has a large channel width at the crossing location (4.0m) and has an estimated 2.7km habitat available upstream with average gradients mapped at less than 15% (Table \@ref(tab:bcfp-125231)). Habitat was rated as high value for salmonid rearing and spawning in surveys conducted in 2019. 
      
<br>      
   
```{r bcfp-125231}
fpr::fpr_table_bcfp(site = 125231,
                    scroll_box_height = scroll_box_height,
                    scroll = gitbook_on)
```


## Identify and Communicate Connectivity Issues {-}


### Habitat Modelling {-}

We are leveraging this project together with numerous others to contributing to the open source development of [`bcfishpass`](https://github.com/smnorris/bcfishpass), [`fwapg`](https://github.com/smnorris/fwapg), [`bcdata`](https://github.com/smnorris/bcdata), [bcfishobs](https://github.com/smnorris/bcfishobs) and [`fpr`](https://github.com/NewGraphEnvironment/fpr).  We are using these database building, habitat/connectivity modeling and data presentation tools to conduct reproducible analysis/presentation of fish passage restoration opportunities in the Parsnip River watershed in order to facilitate outreach, prioritize sites and provide the background information necessary to communicate restoration plans/actions effectively. 

<br>

Results from the Bayesian analysis using on a power model derived by @finnegan_etal2005Controlschannel which relates stream discharge to watershed area and mean annual precipitation are documented in @thorley_etal2021ChannelWidth.  We used this predictor of channel width to model stream segments in the Parsnip River watershed with potentially high intrinsic fisheries habitat value.  Analysis details and resulting predictive formula are included as [Attachment 2](https://www.poissonconsulting.ca/f/859859031) [@thorley_etal2021ChannelWidth].


<br>

Working with Ministry of Environment and Climate Change Strategy we have accessed historic electrofishing data for the entire province from British Columbia databases to begin developing evidence based approaches to modelling the highest value habitat for individual fish species.  This work is an important step to increasing our state of knowledge, informing our field data collection and data management protocols provincially as well as for informing fish passage restoration investment decisions and monitoring outcomes.  This work leverages many initiatives throughout the province and is briefly detailed [here](https://www.newgraphenvironment.com/fissr_explore/big-picture.html) with preliminary results presented as [Attachment 3](https://www.poissonconsulting.ca/f/1386346791) [@amies-galonski_etal2022FISSFish].

<br>

Utilizing modelled channel widths,  a summary of select `bcfishpass` outputs for the 17 sites surveyed with habitat confirmation assessments in 2019 are presented in  `r if(gitbook_on){knitr::asis_output("Table \\@ref(tab:hab-sum-gitbook)")}else knitr::asis_output("Table \\@ref(tab:hab-sum-pdf).")` Complete modelling outputs for the entire watershed group (n = `r bcfishpass %>% pull(aggregated_crossings_id) %>% length()`) are included in an sqlite database available for download [here](https://github.com/NewGraphEnvironment/fish_passage_parsnip_2021_reporting/blob/master/data/bcfishpass.sqlite). 

`r if(gitbook_on){knitr::asis_output("<br>")} else knitr::asis_output("\\pagebreak<br>")`

```{r hab-sum-prep}
my_caption <- 'Summary of updated fish habitat modelling outputs (bull trout model) for habitat confirmation sites surveyed in 2019.'

hab_sum <- bcfishpass_phase2 %>% 
  mutate(map_link = fpr::fpr_my_mapsheet(wshd = 'parsnip', archive_date = '2022-05-27', site = stream_crossing_id),
           map_link = paste0("<a href ='", dbm_mof_50k_grid,"'target='_blank'>Field Map","</a>")) %>% 
  select(stream_crossing_id, 
         pscis_stream_name,
         pscis_road_name,
         stream_order,
         observedspp_upstr,
         dbm_mof_50k_grid,
         map_link,
         contains('bt_'),
         -contains(c('22','30','waterbodies','belowupstrbarriers','bt_stream_km'))) %>% 
  arrange(stream_crossing_id) %>% 
  select(stream_crossing_id:map_link,
         bt_spawning_km,
         bt_rearing_km,
         bt_network_km:bt_slopeclass15_km)

```

```{r hab-sum-gitbook, eval= gitbook_on}


hab_sum %>% 
  select(-dbm_mof_50k_grid) %>% 
  fpr::fpr_kable(caption_text = my_caption,
                 scroll = gitbook_on)
```

```{r hab-sum-pdf, eval = identical(gitbook_on, FALSE)}
hab_sum_names_pdf <- names(hab_sum) %>% 
  str_replace_all(c('bt_'), '') %>% 
  str_replace_all(c('pscis_'), '') %>% 
  str_replace_all(c('_name'), '') %>% 
  str_replace_all(c('slopeclass'), 'slope')
  

hab_sum %>%
  purrr::set_names(nm = hab_sum_names_pdf) %>% 
  select(id = stream_crossing_id,
         stream:road,
         map = dbm_mof_50k_grid,
         spawning_km,
         rearing_km,
         network_km,
         slope03_km:slope15_km) %>% 
  mutate(stream = str_replace_all(stream, 'tributary', 'trib'),
         stream = str_replace_all(stream, 'River', 'R'),
         stream = str_replace_all(stream, 'Creek', 'Ck')) %>% 
  fpr::fpr_kable(caption_text = my_caption,
                 scroll = F) 

```
<br>

### Field Planning  {-}
 Planning for potential 2022 field survey sites is presented `r if(gitbook_on){knitr::asis_output("interactively in Figure \\@ref(fig:widget-planning-caption).")}else knitr::asis_output("in Table \\@ref(tab:tab-planning-pdf). Please not that an interactive fieldwork planning widget prototype has been developed for the project and is located within the online interactive version of the report located [here](https://newgraphenvironment.github.io/fish_passage_parsnip_2021_reporting/).")`  Georeferenced field maps containing updated modelling outputs are presented in `r if(gitbook_on){knitr::asis_output("[here](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27/) and available for bulk download as [Attachment 1](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27/parsnip_2022-05-27.zip).")} else knitr::asis_output("[Attachment 1](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27/parsnip_2022-05-27.zip).")`

```{r field-planning-prep}
# join bcfishpass to some pscis columns for the screening table
# get our dataframe to link to a map
# xings filtered by >1km of potential rearing habitat
xf <- left_join(
  bcfishpass %>% 
    st_as_sf(coords = c('utm_easting', 'utm_northing'), crs = 26910, remove = F) %>% 
    filter(pscis_status != 'HABITAT CONFIRMATION' &
             barrier_status != 'PASSABLE' &
             barrier_status != 'UNKNOWN') %>% 
    # is.na(pscis_status)) %>% 
    filter(bt_rearing_km > 1 &
             crossing_subtype_code != 'BRIDGE') %>%
    rename(bt_rearing_km_raw = bt_rearing_km) %>% 
    mutate(bt_rearing_km = case_when(
      bt_rearing_km_raw >= 1 & bt_rearing_km_raw < 2 ~ '1-2km',
      bt_rearing_km_raw >= 2 & bt_rearing_km_raw <= 5 ~ '2-5km',
      bt_rearing_km_raw >= 5 & bt_rearing_km_raw <= 10 ~ '5-10km',
      T ~ '>10km') 
    ) %>% 
    mutate(bt_rearing_km = factor(bt_rearing_km, levels = c('1-2km', '2-5km', '5-10km', '>10km'))) %>% 
    select(id = aggregated_crossings_id, 
           pscis_status, 
           barrier_status, 
           contains('bt_'), 
           utm_easting,
           utm_northing,
           gradient_gis = gradient,
           mapsheet = dbm_mof_50k_grid) %>% 
    # need to run rowise for our fpr function to hit each row
    rowwise() %>% 
    mutate(map_link = fpr::fpr_my_mapsheet(wshd = 'parsnip', archive_date = '2022-05-27', site = id),
           map_link = paste0("<a href ='", mapsheet,"'target='_blank'>Field Map","</a>")) %>% 
    arrange(id) %>% 
    st_transform(crs = 4326),
  
  pscis %>% 
    select(
      stream_crossing_id, 
      stream_name, 
      road_name, 
      outlet_drop,
      channel_width = downstream_channel_width,
      habitat_value_code,
      image_view_url,
      assessment_comment) %>% 
    mutate(image_view_url = paste0("<a href ='", image_view_url,"'target='_blank'>Culvert Photos","</a>")) %>% 
    st_drop_geometry(),
    
  by = c('id' = 'stream_crossing_id')) %>% 
  select(id,
         stream_name,
         habitat_value = habitat_value_code,
         mapsheet,
         map_link,
         image_view_url,
         pscis_status:bt_slopeclass15_km, 
         bt_spawning_km,
         bt_rearing_km_raw:gradient_gis,
         road_name:assessment_comment)
  # dplyr::relocate(assessment_comment, .after = last_col())
  
  
  

# xf %>%
#   filter(!is.na(pscis_status))
# 
# t <- xf %>%
#   group_by(bt_rearing_km) %>%
#   summarise(n = n())

```


```{r widget-planning, eval = gitbook_on}
# Wrap data frame in SharedData
sd <- SharedData$new(xf %>% select(-mapsheet))


# Use SharedData like a dataframe with Crosstalk-enabled widgets
map <- sd %>% 
  
  leaflet(height=500) %>% #height=500, width=780
  # addTiles() %>% 
  addProviderTiles("Esri.WorldTopoMap", group = "Topo") %>%
  
  addProviderTiles("Esri.WorldImagery", group = "ESRI Aerial") %>% 
  
  addCircleMarkers(
    label = xf$id,
    labelOptions = labelOptions(noHide = T, textOnly = TRUE),
    popup = leafpop::popupTable(xf %>% st_drop_geometry() %>% 
                                select(id, 
                                       stream_name,
                                       bt_rearing_km = bt_rearing_km_raw,
                                       bt_spawning_km,
                                       mapsheet, 
                                       image_view_url, 
                                       assessment_comment),
                                feature.id = F,
                                row.numbers = F),
    radius = 9,
    fillColor = "red",
    color= "#ffffff",
    stroke = TRUE,
    fillOpacity = 1.0,
    weight = 2,
    opacity = 1.0
  ) %>% 
  addLayersControl(
    baseGroups = c(
      "Esri.DeLorme",
      "ESRI Aerial"),
    options = layersControlOptions(collapsed = F)) %>% 
leaflet.extras::addFullscreenControl(position = "bottomright")

# tbl <- reactable::reactable(
#   sd,
#   selection = "multiple",
#   onClick = "select",
#   rowStyle = list(cursor = "pointer"),
#   defaultPageSize = 5
#   # minRows = 10
# )

# htmltools::browsable(
#   htmltools::tagList(map, tbl)
# )



checkbox_map <- bscols(
  widths = c(2, 10),
  filter_checkbox("label", "bt_rearing_km", sd, ~bt_rearing_km),
  map
)

htmltools::browsable(
  htmltools::tagList(checkbox_map,
                     datatable(sd, 
                               class = 'cell-border stripe',
                               extensions=c("Scroller","Buttons","FixedColumns"), 
                               style="bootstrap",
                               # class="compact",
                               width="100%",
                               rownames = F,
                               options=list(
                                 deferRender=TRUE, 
                                 scrollY=300, 
                                 scrollX = T,
                                 scroller=TRUE,
                                 dom = 'Bfrtip',
                                 buttons = list(
                                   'copy',
                                   list(
                                     extend = 'collection',
                                     buttons = c('csv'),
                                     text = 'Download csv')),
                               fixedColumns = list(leftColumns = 2),
                               initComplete = JS("function(settings, json) {","$(this.api().table().container()).css({'font-size': '11px'});","}")),
                               escape = F)
  ))

```

```{r widget-planning-caption, fig.cap= my_caption, out.width = "0.01%",  eval = gitbook_on}
my_photo = 'fig/pixel.png'
my_caption= 'Field planning widget to facilitate planning for 2022 field surveys.'
knitr::include_graphics(my_photo, dpi = NA)
```


```{r tab-planning-pdf, eval= identical(gitbook_on, FALSE)}

# identical(gitbook_on, FALSE)
my_caption = 'Field planning results to facilitate selection of restoration opportunities for 2022 field surveys.'

xf %>% 
  sf::st_drop_geometry() %>% 
  select(id:habitat_value,
         outlet_drop,
         bt_spawning_km, 
         bt_rearing_km = bt_rearing_km_raw,
         mapsheet,
         utm_easting,
         utm_northing,
         assessment_comment) %>% 
  
  # test by removing the html
  select(-mapsheet) %>% 
  fpr::fpr_kable(caption_text = my_caption,
                 scroll = gitbook_on)
  # fpr_kable(caption_text = caption_text,
  #           scroll = gitbook_on)

```

### Mapping {-}

#### QGIS {-}

Updated map for the Parsnip River, Carp River and Crooked River watershed groups incorporating the newly developed sa'ba (bull trout) spawning and rearing habitat model are available [here](https://hillcrestgeo.ca/outgoing/fishpassage/projects/parsnip/archive/2022-05-27/). 


#### Web Mapping {-}

An online connectivity mapping portal for the Peace Region is located [here](https://newgraphenvironment.github.io/fish_passage_parsnip_2021_webmap). At the time of reporting the site was undergoing development with the interface expected to evolve significantly over the coming months.  Future layers to be added to map include fisheries observations, the  [Recreational Opportunity Spectrum Inventory data](https://catalogue.data.gov.bc.ca/dataset/recreational-opportunity-spectrum-inventory), hydrometric station locations, historic fish sampling sites, wetlands, etc.  
